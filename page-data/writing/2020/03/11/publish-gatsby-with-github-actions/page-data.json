{
    "componentChunkName": "component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx",
    "path": "/writing/2020/03/11/publish-gatsby-with-github-actions",
    "result": {"data":{"post":{"slug":"/2020/03/11/publish-gatsby-with-github-actions","title":"Pusblish Gatsby with Github Actions","date":"Mar 11, 2020","tags":[{"name":"Gatsby","slug":"gatsby"},{"name":"Github Pages","slug":"github-pages"},{"name":"Github Workflows","slug":"github-workflows"}],"description":"Since you've taken the time to get your Github Pages site setup with Gatsby, you should probably add automated publishing next.  With the help of Github Workflows and Gatsby Publish Action it takes seconds (or a few minutes tops).","canonicalUrl":null,"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Pusblish Gatsby with Github Actions\",\n  \"description\": \"Since you've taken the time to get your Github Pages site setup with Gatsby, you should probably add automated publishing next.  With the help of Github Workflows and Gatsby Publish Action it takes seconds (or a few minutes tops).\",\n  \"date\": \"2020-03-11T00:00:00.000Z\",\n  \"tags\": [\"Gatsby\", \"Github Pages\", \"Github Workflows\"],\n  \"slug\": \"/2020/03/11/publish-gatsby-with-github-actions\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Now that I've got things rolling with my \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"/writing/2020/03/01/here-comes-gatsby\"\n  }, \"Gatsby conversion\"), \" and everything seems good working with Github Pages, it was time to automate the build/release process. What a great chance to start playing with a little Github Actions (Yup, I know this stuff is old - but it's still new to me!). Right off the bat, my two priorties are to:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Automate the build when publishing new content to the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"gatsby\"), \" branch\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Perform a test build of any pull requests that come in.\")), mdx(\"p\", null, \"With these two things, I have the ability to make modifications on the fly directly from Github as well as start following a few best practices for new content. Enter:\"), mdx(\"h3\", null, \"Github Workflows\"), mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://help.github.com/en/actions/configuring-and-managing-workflows/configuring-and-managing-workflow-files-and-runs\"\n  }, \"Github Workflows\"), \" provide the ability to configure any number of jobs, performed as reactions to common Gitub and API actions.\"), mdx(\"h3\", null, \"Gatbsy GH Pages Action\"), mdx(\"p\", null, \"While Googling around I found this little gem of a project, \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/marketplace/actions/gatsby-publish\"\n  }, \"Gatsby Publish action\"), \" that did exactly what I was looking for; with regards to publishing the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gatsby\"), \" branch to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"master\"), \" on push. With a couple \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/enriikke/gatsby-gh-pages-action/pull/16\"\n  }, \"changes\"), \" it's possible to perform only a build, by \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"skip-publish\"), \"ing the job.\"), mdx(\"h2\", null, \"Github Workflow Config\"), mdx(\"p\", null, \"The first step to setting up workflows is to create a configuration file, from your project page:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"click on \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Actions\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"then \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"New Workflow\"), \".\")), mdx(\"h3\", null, \"publish-gatsby.yml\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yml\"\n  }, \"# Publish Gatsby\\nname: publish-gatsby\\n\\n# Controls when the action will run. Triggers the workflow on push or pull request\\n# events but only for the master branch\\non:\\n  push:\\n    branches:\\n      - gatsby\\n\\n# A workflow run is made up of one or more jobs that can run sequentially or in parallel\\njobs:\\n  # This workflow contains a single job called \\\"build\\\"\\n  build:\\n    # The type of runner on which this job will run\\n    runs-on: ubuntu-latest\\n\\n    # Steps represent a sequence of tasks that will be executed as part of the job\\n    # - Checkout gatsby branch\\n    # - Update authentication for Github Package Registry @kenjdavidson/base16-scss\\n    # - Build gh-pages using action\\n    steps:\\n      - uses: actions/checkout@v1\\n      - name: Authenticate with GitHub package registry\\n        run: echo \\\"//npm.pkg.github.com/:_authToken=${{ secrets.ACCESS_TOKEN }}\\\" > ~/.npmrc\\n      - uses: enriikke/gatsby-gh-pages-action@v2\\n        with:\\n          access-token: ${{ secrets.ACCESS_TOKEN }}\\n\")), mdx(\"p\", null, \"At a high level this file is:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Kicking the workflow off on Push and Pull of the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"gatsby\"), \" branch, which is configured as my main branch\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Checks out the branch\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Applies any custom logic (see below)\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Runs the gh-pages action\")), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"The highlighted lines are used to import the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"@kenjdavidson/base16-scss\"), \" package which I have posted to Github Package Registry, if you don't have any package registry requirements, these lines can be removed from your configuration file.\")), mdx(\"h3\", null, \"validate-pull-request.yml\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yml\"\n  }, \"# Validates that the pull request branch will build\\nname: validate-pull-request\\n\\n# Fires on pull-request to gatsby branc\\non:\\n  pull_request:\\n    branches:\\n      - gatsby\\n\\n# A workflow run is made up of one or more jobs that can run sequentially or in parallel\\njobs:\\n  # This workflow contains a single job called \\\"build\\\"\\n  build:\\n    # The type of runner on which this job will run\\n    runs-on: ubuntu-latest\\n\\n    # Steps represent a sequence of tasks that will be executed as part of the job\\n    # - Checkout gatsby branch\\n    # - Update authentication for Github Package Registry @kenjdavidson/base16-scss\\n    # - Build gh-pages using action\\n    steps:\\n      - uses: actions/checkout@v1\\n      - name: Authenticate with GitHub package registry\\n        run: echo \\\"//npm.pkg.github.com/:_authToken=${{ secrets.ACCESS_TOKEN }}\\\" > ~/.npmrc\\n      - uses: kenjdavidson/gatsby-gh-pages-action@feature/build-only-config\\n        with:\\n          access-token: ${{ secrets.ACCESS_TOKEN }}\\n          skip-publish: true\\n\")), mdx(\"p\", null, \"configured with the same items as the original, except for the added \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"skip-publish: true\"), \" in order stop after a successful build. Ensures that pull requests will at least compile properly when merging the pull request from Github.\"), mdx(\"h3\", null, \"Project Secrets\"), mdx(\"p\", null, \"This workflow requires access to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Github Package Registry\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Push\"), \" to the repository, this is where the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"secrets.ACCESS_TOKEN\"), \" comes in. First you'll need to create a Github \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://help.github.com/en/github/authenticating-to-github/creating-a-personal-access-token-for-the-command-line\"\n  }, \"personal access token\"), \", I won't get into those steps here, they are pretty straight forward.\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Note - once you create your access token you can't ever get it back. So you'll either need to store it somewhere safe, regenterate it (which would require you updating all other places its required), or have one per action/feature so that resetting doesn't affect anything else. I'm unsure of Github best practices?\")), mdx(\"p\", null, \"In order to configure your \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://help.github.com/en/actions/configuring-and-managing-workflows/creating-and-storing-encrypted-secrets\"\n  }, \"secrets\"), \", from you project page:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Click \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Settings\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Click \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Secrets\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Add New Secret\"))), mdx(\"p\", null, \"You'll be asked to enter the name \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ACCESS_TOKEN\"), \" (required by the action) and the content.\"), mdx(\"h2\", null, \"Running the Workflow\"), mdx(\"p\", null, \"As the actions are defined, you'll kick off one of the two actions by either:\"), mdx(\"h3\", null, \"Pushing to Gatsby branch\"), mdx(\"p\", null, \"Each push will now fire a build and publish - great for editing/correcting those pesky issues directly on Github.\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Note\"), \" - originally I had the publish workflow configured for \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"pull-reqeust\"), \" as well. This caused the build to actually publish the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"feature/branch\"), \" to production, instead of just ensuring the build.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"797px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"56.666666666666664%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACI0lEQVQoz52SaUtUURjH75do0ZjcZjS31Jw09wUZC0PsdR+gKCiCIikoepcYoTD4RYo+QJBRL7INWtTURsMZm7lz77n7nesvzokZaHvTgR//52z/8zyHR8vpFh92bD7uWGxkLVY2BW+/WrzftnmXsTEdnyAMcT0fPwjx/EAhY9crq19BC4MIYblqwxQ2judj2Q553UDYDnouy97WOo5pUDQttWc7LkVD4LgehaKB48pHS/hBCa1g63zX8xQKOrm9PKYp8P0AISx1QVg2wrLwg0DFjuPiuC6msFRGhimUSsMgCNGWt5/yeW+L1Y0sr1Zeky/oeL7P/w6tFIaVEoxikf0oQq5FUUkdePT4CRcvX2X29l1u3rrDteuzXLh05Z9ojheQ+ZYls7Or/qgUQRjt4/qhMpx7sEDV0Tgd3X20dfbQ3J6kJt5CdU2Cw7EGqmINSstoo/MbnFvKMJ3OMDK/iZxLRubWGFvM0X3+PolEnGTfKCd6BqlvbCPR3EFjS6eiqbXrF7Tna4KXXyxerAuWVwVyLnn2yeDNLty4t8iR2noGx1KMp6YYHp9kYHiiYhg/dpyGpvYKGkT8lf1AlZxOL3EwVsfQWIrUmWnF5NQME5NnOT01Q2tHUmUtjSWa58tm/RPb8ZThw4U0h2J1DIxMKJPegZ+lJ3uHSJ4aVlnKzCqGqn9+Qza5bFZluJjmQHUNXSf76Ur2q8u18RZq461Ky2Zl/QGiF5TlDyB3TAAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Publish Gatsby Workflow\",\n    \"title\": \"Publish Gatsby Workflow\",\n    \"src\": \"/static/a07921b4410e450eb787a6d98d28d7e4/a14f6/gatsby-publish.png\",\n    \"srcSet\": [\"/static/a07921b4410e450eb787a6d98d28d7e4/5243c/gatsby-publish.png 240w\", \"/static/a07921b4410e450eb787a6d98d28d7e4/ab158/gatsby-publish.png 480w\", \"/static/a07921b4410e450eb787a6d98d28d7e4/a14f6/gatsby-publish.png 797w\"],\n    \"sizes\": \"(max-width: 797px) 100vw, 797px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(\"h3\", null, \"Submitting a pull request\"), mdx(\"p\", null, \"I've submitted a pull request for this specific draft, which kicked off the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"validate-pull-request\"), \" action:\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"758px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"55.833333333333336%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB1klEQVQoz3WS8YrcIBjE9/3/7eP0HQqFHoVCD3ZvN4mJuibGRI36K7p7x9FSYfKpmHG+GU8AIQQmqZBKM06yzdu6QSKVYpwmJilRSqOUYp4Xtn3n73GqH+89XT8wDAIhRsQ4tXn9IcZICJF99+2c96EJqHvHcZBzeSJTSnkQ1nEcCTGOnM8XbreuKeoHweXyRt8P/G+U8o4H8SmnnZwiqcDqNpQ22NVxpNQuOVJuqApyTv+g5AQlQ0ntzEm+fMFevxKWV7y9EreJsA74BsG2vLHbjpwCpdS20gcqSTwO1BpRNpBS5BTthbgNBNcz646+OyP6M85K/GbY7MTu1Ce/MvnZXm0z5cIWM84nUjoeHlYPOAo/Xn7Si5qqYZw0UhtGeUdMGnU3mMViZos2M5PS3M1CiLGpvOkdHwKnypZS4Lv6xuvltQVQE6+hdH3PretbOIMYWzXzQr2/qSzlI+VqR85PhTlHfttfCFWfy8ggRCOtuN46tFa4dWW1C8G/v73yCTz8rYRtqySWu+N6G+iGkUnd8TGxWMdsHXJNDaNNiDmizYIwnsFEBhOYloiPB+mI7woPZjsjlUTfqzcGtzmcWxvstrNue6sV2+baet19q273hLA36/4Aj/tRLbVShSwAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Pull Request\",\n    \"title\": \"Pull Request\",\n    \"src\": \"/static/484dc648f5095193f7d29b18eb85170d/5458a/validate-pull-request.png\",\n    \"srcSet\": [\"/static/484dc648f5095193f7d29b18eb85170d/5243c/validate-pull-request.png 240w\", \"/static/484dc648f5095193f7d29b18eb85170d/ab158/validate-pull-request.png 480w\", \"/static/484dc648f5095193f7d29b18eb85170d/5458a/validate-pull-request.png 758w\"],\n    \"sizes\": \"(max-width: 758px) 100vw, 758px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(\"p\", null, \"Once I get up and running with some actual React/Gatsby testing, I'll be able to take more advantage of these workflows.\"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"Now that I've got things rolling with my  Gatsby conversion  and everything seems good working with Github Pages, it was time to automate…","timeToRead":2,"banner":null}},"pageContext":{"slug":"/2020/03/11/publish-gatsby-with-github-actions","formatString":"MMM DD, yyyy"}},
    "staticQueryHashes": ["2744905544","3090400250","318001574"]}