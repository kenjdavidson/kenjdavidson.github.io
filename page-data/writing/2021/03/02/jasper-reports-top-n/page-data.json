{
    "componentChunkName": "component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx",
    "path": "/writing/2021/03/02/jasper-reports-top-n",
    "result": {"data":{"post":{"slug":"/2021/03/02/jasper-reports-top-n","title":"Simulating TOP N / RANK() with Jasper Reports","date":"Mar 02, 2021","tags":[{"name":"Jasper Reports","slug":"jasper-reports"},{"name":"Java","slug":"java"},{"name":"Scriptlets","slug":"scriptlets"}],"description":"Ran into an issue where I needed to simulate TOP N / RANK() with Jasper Reports","canonicalUrl":null,"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Simulating TOP N / RANK() with Jasper Reports\",\n  \"description\": \"Ran into an issue where I needed to simulate TOP N / RANK() with Jasper Reports\",\n  \"date\": \"2021-03-02T00:00:00.000Z\",\n  \"tags\": [\"Jasper Reports\", \"Java\", \"Scriptlets\"],\n  \"slug\": \"/2021/03/02/jasper-reports-top-n\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"While attempting to get some reports working I ran into a problem where:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Our database (version) doesn't support the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"RANK()\"), \" function\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Jasper Server (a normally wonderful reporting library) wasn't correctly \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"summarizing\"), \" on \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"ReportGroup\"))), mdx(\"h2\", null, \"The Issue\"), mdx(\"p\", null, \"The report being worked on had a requirement that the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Top N\"), \" needed to be displayed, as with almost all cases the Top N needed to include ties. So for example if we were looking up the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Top 3\"), \" from the following data:\"), mdx(\"table\", null, mdx(\"thead\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"thead\"\n  }, mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Wins\"), mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Seconds\"), mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Thirds\"))), mdx(\"tbody\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, mdx(\"strong\", {\n    parentName: \"td\"\n  }, \"5\")), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"2\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"2\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, mdx(\"strong\", {\n    parentName: \"td\"\n  }, \"4\")), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"1\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"1\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, mdx(\"strong\", {\n    parentName: \"td\"\n  }, \"3\")), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"1\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"4\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, mdx(\"strong\", {\n    parentName: \"td\"\n  }, \"3\")), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"2\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"2\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, mdx(\"strong\", {\n    parentName: \"td\"\n  }, \"1\")), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"4\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"4\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, mdx(\"strong\", {\n    parentName: \"td\"\n  }, \"0\")), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"4\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"4\")))), mdx(\"p\", null, \"the top ranking values are \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"5, 4, 3, 3\"), \" so the report must show 4 people in this instance, not 3. Generally you'd be able to:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"RANK()\"), \" over \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"wins\"), \" in the query, although it may be that your database doesn't support \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"RANK()\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Add a \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"TopNCountTotal\"), \" variable that only gets incremented when the group changes (which sadly doesn't work in Jasper properly)\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Filter over \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"topNumber\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"record.getWins()\"), \" in code before passing into the Jasper Report as a \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"JRDatasourceBean\"), \", which in this case loses our ability to have the report available in multiple places.\")), mdx(\"p\", null, \"my final solution was to create the following \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://jasperreports.sourceforge.net/sample.reference/scriptlet/\"\n  }, \"Scriptlet\")), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"There are situations when a calculation is required during the report filling stage that is not included in JasperReports provided calculations.\\nExamples of this may be complex String manipulations, building of Maps or Lists of objects in memory or manipulations of dates using 3rd party Java APIs.\\nLuckily JasperReports provides us with a simple and powerful means of doing this with Scriptlets.\")), mdx(\"p\", null, \"...luckily\"), mdx(\"h3\", null, \"Scriptlet\"), mdx(\"p\", null, \"The scriptlet is very primitive, compared to other's I've needed, it really only needs to summarize the previous group count into the running total. Using our example above, we'd like things to be incremented as such:\"), mdx(\"table\", null, mdx(\"thead\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"thead\"\n  }, mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Wins\"), mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Seconds\"), mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Thirds\"), mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Group Count\"), mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Total Count\"))), mdx(\"tbody\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, mdx(\"strong\", {\n    parentName: \"td\"\n  }, \"5\")), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"2\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"2\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"1\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"0\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, mdx(\"strong\", {\n    parentName: \"td\"\n  }, \"4\")), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"1\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"1\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"1\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"1\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, mdx(\"strong\", {\n    parentName: \"td\"\n  }, \"3\")), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"1\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"4\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"1\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"2\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, mdx(\"strong\", {\n    parentName: \"td\"\n  }, \"3\")), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"2\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"2\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"2\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"2\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, mdx(\"strong\", {\n    parentName: \"td\"\n  }, \"1\")), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"4\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"4\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"1\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"3\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, mdx(\"strong\", {\n    parentName: \"td\"\n  }, \"0\")), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"4\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"4\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"1\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"4\")))), mdx(\"p\", null, \"we can see how the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Group Count\"), \" restarts at each group change and how the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Total Count\"), \" is summarized (is always a group behind the current row). So in this case we know that we only want to display data with \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"$V{TopNCountTotal} < $P{topNumber}\"), \". Sadly we need to get all the data back in order to do this, but for the time being the data on which we're working isn't that big.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-java\"\n  }, \"public class GroupTopNCounterScriptlet extends JRDefaultScriptlet {\\n    public static final String GROUP_COUNT_VAR = \\\"GroupTopN_COUNT\\\";\\n    public static final String TOP_N_TOTAL = \\\"TopNCountTotal\\\";\\n\\n    int topNTotalCounter = 0;\\n\\n    @Override\\n    public void beforeGroupInit(String groupName) throws JRScriptletException {\\n        Integer groupCount = (Integer) getVariableValue(GROUP_COUNT_VAR);\\n        topNTotalCounter += (groupCount == null) ? 0 : groupCount;\\n        setVariableValue(TOP_N_TOTAL, topNTotalCounter);\\n    }\\n}\\n\")), mdx(\"h3\", null, \"Jasper Report\"), mdx(\"p\", null, \"Once the Scriptlet is made available and set on the Jasper Report, the only things remaining are to:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Ensure that your query uses the appropriate sort field. One thing I didn't mention here is that my sort field changes based on parameters, which is probably why you've asked\")), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Why didn't he just count the distinct values as he went through the rows.\")), mdx(\"p\", null, \"the main problem is that you can't dynamic a dynamic variable in Jasper.\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Configure your main \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Detail\"), \" section to only display when appropriate:\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"$V{TopNCountTotal} < $P{topNumber}\\n\")), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Keep a running total of your group counts only while the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"TopNCountTotal\"), \" is lower than your \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"topNumber\"), \". This way you can display the total in the summary based on how many are actually displayed, and not in the full list.\")), mdx(\"h2\", null, \"Result\"), mdx(\"p\", null, \"We get the table we want with the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Top 3\"), \" including Rank():\"), mdx(\"table\", null, mdx(\"thead\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"thead\"\n  }, mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Wins\"), mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Seconds\"), mdx(\"th\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"Thirds\"))), mdx(\"tbody\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, mdx(\"strong\", {\n    parentName: \"td\"\n  }, \"5\")), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"2\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"2\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, mdx(\"strong\", {\n    parentName: \"td\"\n  }, \"4\")), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"1\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"1\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, mdx(\"strong\", {\n    parentName: \"td\"\n  }, \"3\")), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"1\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"4\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, mdx(\"strong\", {\n    parentName: \"td\"\n  }, \"3\")), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"2\"), mdx(\"td\", {\n    parentName: \"tr\",\n    \"align\": null\n  }, \"2\")))));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"While attempting to get some reports working I ran into a problem where: Our database (version) doesn't support the  RANK()  function Jasper…","timeToRead":2,"banner":null}},"pageContext":{"slug":"/2021/03/02/jasper-reports-top-n","formatString":"MMM DD, yyyy"}},
    "staticQueryHashes": ["2744905544","3090400250","318001574"]}